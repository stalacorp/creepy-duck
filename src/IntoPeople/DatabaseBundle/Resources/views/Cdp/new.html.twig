{% extends '::base.html.twig' %} {% block body -%}
    <div class="row">
    <div class="col-lg-3 col-md-4">
    {{ form(form) }}
    </div>
    </div>
    <div id="result"></div>


{% endblock %}

{% block javascripts -%}
    {{ parent() }}
    <script>
        var count = 0;
        function getform() {
            $.ajax({
                url: Routing.generate('cdp_edit', {
                    languageId: $('#form_language').val(),
                    id: {{ entity.id }},
                    _locale:locale
                }),
                success: function (result) {
                    $("#result").html(result);

                }
            });
        }

        $(function () {
            getform();

            $('#form_language').change(function () {
                getform();
            });

            $('.submit-button').on('click', function(){
                
            });


            $(document).on('click', '#intopeople_databasebundle_cdp_saveAndAdd', function(){
                alert('test');
                var form = $('form[name="intopeople_databasebundle_cdp"]');
                var data = form.serializeArray();
                data.push( {'name':$(this).attr('name')});
                $.ajax({
                    type: 'POST',
                    url: form.attr('action'),
                    dataType: 'html',
                    data : data,
                    success: function(answer) {
                        location.href= Routing.generate('myfeedbackcycle', {
                            id: answer,
                            _locale:locale
                        });
                    },
                    error: function() {
                    },
                    complete: function() {
                    }
                });
                return false;
            });

            $(document).on('click', '#intopeople_databasebundle_cdp_save', function(){
                var form = $('form[name="intopeople_databasebundle_cdp"]');
                var data = form.serializeArray();
                data.push( {'name':$(this).attr('name')});
                $.ajax({
                    type: 'POST',
                    url: form.attr('action'),
                    dataType: 'html',
                    data : data,
                    success: function(answer) {
                        location.href= Routing.generate('myfeedbackcycle', {
                            id: answer,
                            _locale:locale
                        });

                    },
                    error: function() {
                    },
                    complete: function() {
                    }
                });
                return false;
            });

            $(document).on('click', '.qualityoption' , function(){
                if ($(this).hasClass('btn-default')){
                    if (count != 5){
                        $(this).toggleClass('btn-default');
                        $(this).toggleClass('btn-success');
                        count++;
                    }else {
                        $('#qualityerror').html('{{ 'cdp.modal.max5error' | trans }}');
                    }
                }else {
                    $(this).toggleClass('btn-default');
                    $(this).toggleClass('btn-success');
                    count--;
                }
            });

            $(document).on('click', '#corequalityok', function(){
                if (count >= 3){
                    $('#corequalitiesModal').modal('hide');
                    var teller = 1;
                    $.each( $('.btn-success'), function() {
                        $('#intopeople_databasebundle_cdp_coreQuality' + teller).parent().append($(this).text());
                        $('#intopeople_databasebundle_cdp_coreQuality' + teller).val($(this).text());
                        teller++;
                    });
                    $('#qualityerror').html('');
                    if (count == 4){
                        $('#corequalitytable').find('.hidden').first().removeClass('hidden');
                    }
                    if (count == 5){
                        $('#corequalitytable').find('.hidden').removeClass('hidden');
                    }
                }else {
                    $('#qualityerror').html('{{ 'cdp.modal.min3error' | trans }}');
                }
            });

            $(document).on('click', '#custombutton', function(){
                var text = $('#custom').val();
                if (text != '') {
                    if (count != 5) {
                        var tr = $('#corequalitiesmodaltable').find('tr:last');
                        if ($(tr).find('td').length == 5) {
                            $('#corequalitiesmodaltable').append('<tr></tr>');
                        }

                        $('#corequalitiesmodaltable').find('tr:last').append('<td>' + '<button class="btn qualityoption btn-block btn-success">' + text + '</button>' + '</td>');

                        count++;

                    } else {
                        $('#qualityerror').html('{{ 'cdp.modal.max5error' | trans }}');
                    }
                }
            });




            $(document).on('click', '.addButton', function () {
                $(this).parent().parent().parent().find('.hidden').first().removeClass('hidden');

            });

            $(document).on('click', '.removeButton', function () {
                $(this).parent().parent().addClass('hidden');
            });
        });

    </script>
{% endblock %}

